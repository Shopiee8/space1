import{a9 as S,M as T}from"./entry.3e07ed2f.js";function A(p,m){for(var d=0;d<m.length;d++){const l=m[d];if(typeof l!="string"&&!Array.isArray(l)){for(const c in l)if(c!=="default"&&!(c in p)){const f=Object.getOwnPropertyDescriptor(l,c);f&&Object.defineProperty(p,c,f.get?f:{enumerable:!0,get:()=>l[c]})}}}return Object.freeze(Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}))}var b={exports:{}};(function(p,m){(function(d,l){l(m)})(T,function(d){function l(n){return n}const c="tp";function f(n){return(t,i)=>[c,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}function j(n,e){const i=Object.keys(e).reduce((r,a)=>{if(r===void 0)return;const o=e[a],v=o(n[a]);return v.succeeded?Object.assign(Object.assign({},r),{[a]:v.value}):void 0},{});return i}function D(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const r=e(i);if(!(!r.succeeded||r.value===void 0))return[...t,r.value]},[])}function E(n){return n===null?!1:typeof n=="object"}function s(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function L(n){return{custom:e=>s(e)(n),boolean:s(e=>typeof e=="boolean"?e:void 0)(n),number:s(e=>typeof e=="number"?e:void 0)(n),string:s(e=>typeof e=="string"?e:void 0)(n),function:s(e=>typeof e=="function"?e:void 0)(n),constant:e=>s(t=>t===e?e:void 0)(n),raw:s(e=>e)(n),object:e=>s(t=>{if(!!E(t))return j(t,e)})(n),array:e=>s(t=>{if(!!Array.isArray(t))return D(t,e)})(n)}}const _={optional:L(!0),required:L(!1)};function O(n,e){const t=_.required.object(e)(n);return t.succeeded?t.value:void 0}function h(n,e,t,i){function r(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function v(g){try{y(i.next(g))}catch(I){o(I)}}function U(g){try{y(i.throw(g))}catch(I){o(I)}}function y(g){g.done?a(g.value):r(g.value).then(v,U)}y((i=i.apply(n,e||[])).next())})}function x(){const n=document.createElement("canvas");n.width=128,n.height=64;const e=n.getContext("2d");return e.fillStyle="#222",e.fillRect(0,0,n.width,n.height),e.fillStyle="#ddd",e.font="monospaced",e.textAlign="center",e.textBaseline="middle",e.fillText("No image",n.width*.5,n.height*.5),new Promise(t=>{n.toBlob(i=>{const r=new Image;r.src=URL.createObjectURL(i),r.onload=()=>{t(r)}})})}function w(n){return h(this,void 0,void 0,function*(){const e=new Image;return e.crossOrigin="anonymous",new Promise(t=>{e.src=n,e.onload=()=>{t(e)}})})}function P(n){const e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0);const i=new Image;return new Promise(r=>{e.toBlob(a=>{i.src=URL.createObjectURL(a),i.onload=()=>{r(i)}})})}const u=f("img");class F{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(u()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(u("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.element.appendChild(this.input),this.image_=e.createElement("img"),this.image_.classList.add(u("image")),this.image_.classList.add(u(`image_${t.imageFit}`)),this.element.classList.add(u("area_root")),this.element.appendChild(this.image_)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?t==null||t.classList.add(u("area_dragging")):t==null||t.classList.remove(u("area_dragging"))}}class R{constructor(e,t){this.placeholderImage=null,this.value=t.value,this.viewProps=t.viewProps,this.view=new F(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(e){const t=(e==null?void 0:e.target).files;if(!t||!t.length)return;const i=t[0],r=URL.createObjectURL(i);this.setValue(r),this.updateImage(r)}onDrop(e){return h(this,void 0,void 0,function*(){e.preventDefault();try{const{dataTransfer:t}=e,i=t==null?void 0:t.files[0];if(i){const r=URL.createObjectURL(i);this.updateImage(r),this.setValue(r)}else{const r=t==null?void 0:t.getData("url");if(!r)throw new Error("No url");w(r).then(a=>h(this,void 0,void 0,function*(){const o=yield P(a);this.updateImage(o.src),this.setValue(o)}))}}catch(t){console.error("Could not parse the dropped image",t)}finally{this.view.changeDraggingState(!1)}})}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){return h(this,void 0,void 0,function*(){if(e instanceof HTMLImageElement)P(e).then(t=>{this.updateImage(t.src)});else if(typeof e=="string"){let t="";try{if(e==="placeholder")throw new Error("placeholder");new URL(e),t=(yield w(e)).src}catch{t=(yield this.handlePlaceholderImage()).src}finally{this.updateImage(t),this.setValue(t)}}})}updateImage(e){this.view.changeImage(e)}setValue(e){return h(this,void 0,void 0,function*(){e instanceof HTMLImageElement?this.value.setRawValue(e):e?this.value.setRawValue(yield w(e)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return h(this,void 0,void 0,function*(){return this.placeholderImage||(this.placeholderImage=yield x()),this.placeholderImage})}}const C=[".jpg",".png",".gif"],k={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:grid;height:calc(var(--bld-us) * 3);overflow:hidden;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:100%;height:100%;opacity:0}.tp-imgv_image{width:100%;height:100%;position:absolute;pointer-events:none;border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:6px;opacity:0.6}",accept(n,e){if(!(n instanceof HTMLImageElement||typeof n=="string"))return null;const t=_,i=O(e,{view:t.required.constant("input-image"),acceptUrl:t.optional.boolean,imageFit:t.optional.custom(r=>r==="contain"||r==="cover"?r:void 0),extensions:t.optional.array(t.required.string)});return i?{initialValue:n,params:i}:null},binding:{reader(n){return e=>e instanceof HTMLImageElement?e.src===""?"placeholder":e.src:typeof e=="string"?e:"placeholder"},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new R(n.document,{value:n.value,imageFit:(e=n.params.imageFit)!==null&&e!==void 0?e:"cover",viewProps:n.viewProps,extensions:(t=n.params.extensions)!==null&&t!==void 0?t:C})}};d.plugin=k,Object.defineProperty(d,"__esModule",{value:!0})})})(b,b.exports);const V=S(b.exports),B=A({__proto__:null,default:V},[b.exports]);export{B as t};
